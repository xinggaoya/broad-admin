# Broad Admin 开发文档

## 项目概述

Broad Admin 是一个基于 Spring Boot 3.x + Vue 3 + TypeScript + Naive UI 的现代化后台管理系统。项目采用前后端分离架构，提供完整的权限管理、系统监控、定时任务等功能。

### 项目结构

```
broad-admin/
├── broad-admin-ui/          # 前端项目 (Vue 3 + TypeScript + Naive UI)
├── broad-admin/             # 主应用模块 (Spring Boot 启动类和控制器)
├── broad-common/            # 公共模块 (工具类、常量、异常处理等)
├── broad-framework/         # 框架模块 (配置、切面、异常处理等)
├── broad-system/            # 系统模块 (用户、角色、菜单等核心功能)
├── broad-quartz/            # 定时任务模块
├── sql/                     # 数据库脚本
├── logs/                    # 日志文件
├── docker-compose.yml       # Docker 编排文件
└── Dockerfile              # Docker 镜像构建文件
```

## 技术栈

### 后端技术栈

| 技术         | 版本     | 说明         |
| ------------ | -------- | ------------ |
| Spring Boot  | 3.2.1    | 基础框架     |
| Java         | 17       | 开发语言     |
| MyBatis Plus | 3.5.10.1 | ORM 框架     |
| Sa-Token     | 1.39.0   | 权限认证框架 |
| Druid        | 1.2.20   | 数据库连接池 |
| FastJson2    | 2.0.45   | JSON 处理    |
| SpringDoc    | 2.3.0    | API 文档     |
| Quartz       | -        | 定时任务     |
| Hutool       | 5.8.25   | 工具类库     |
| Lombok       | 1.18.30  | 代码简化     |

### 前端技术栈

| 技术       | 版本   | 说明         |
| ---------- | ------ | ------------ |
| Vue        | 3.4.25 | 前端框架     |
| TypeScript | 5.4.0  | 开发语言     |
| Vite       | 5.2.8  | 构建工具     |
| Naive UI   | 2.38.1 | UI 组件库    |
| Pinia      | 2.1.7  | 状态管理     |
| Vue Router | 4.3.2  | 路由管理     |
| Ky         | 1.2.4  | HTTP 客户端  |
| ECharts    | 5.5.0  | 图表库       |
| Sass       | 1.75.0 | CSS 预处理器 |

### 自动导入配置

项目配置了自动导入功能，无需手动导入以下内容：

| 插件                    | 版本   | 自动导入内容          |
| ----------------------- | ------ | --------------------- |
| unplugin-auto-import    | 0.17.5 | Vue 3 API、组合式函数 |
| unplugin-vue-components | 0.26.0 | Naive UI 组件         |

## 开发环境配置

### 后端环境

1. **JDK 17+**
2. **Maven 3.6+**
3. **MySQL 8.0+**
4. **Redis 6.0+**

### 前端环境

1. **Node.js 18+**
2. **pnpm 8+** (推荐使用 pnpm)

### 启动步骤

#### 后端启动

```bash
# 1. 导入数据库脚本 (sql/ 目录下)
# 2. 修改配置文件 application.yml 中的数据库和 Redis 配置
# 3. 启动应用
mvn spring-boot:run
# 或者在 IDE 中运行 BroadApplication.java
```

#### 前端启动

```bash
cd broad-admin-ui
pnpm install
pnpm dev
```

访问地址：http://localhost:3000

## 代码规范与开发指南

### 后端开发规范

#### 1. 项目结构规范

```
com.broad.web.controller/    # 控制器层
com.broad.system.service/    # 服务接口层
com.broad.system.service.impl/ # 服务实现层
com.broad.system.entity/     # 实体类
com.broad.system.mapper/     # 数据访问层
com.broad.common.utils/      # 工具类
com.broad.common.constant/   # 常量类
com.broad.common.exception/  # 异常类
```

#### 2. 控制器开发规范

```java
@RestController
@RequestMapping("sysUser")
public class SysUserController extends BaseController {

    @Autowired
    private SysUserService sysUserService;

    /**
     * 分页查询用户列表
     */
    @GetMapping
    @SaCheckPermission("sys:user:list")
    public TableDataInfo selectAll(SysUser sysUser) {
        Page<SysUser> page = startPage();
        return getDataTable(this.sysUserService.selectAll(sysUser, page));
    }

    /**
     * 根据ID查询用户
     */
    @GetMapping("{id}")
    @SaCheckPermission("sys:user:list")
    public ResultData selectOne(@PathVariable Serializable id) {
        return success(this.sysUserService.getById(id));
    }

    /**
     * 新增用户
     */
    @PostMapping
    @SaCheckPermission("sys:user:add")
    @Log(description = "新增用户", businessType = BusinessType.INSERT)
    public ResultData insert(@RequestBody @Valid SysUser sysUser) {
        return toResult(this.sysUserService.saveAdmin(sysUser));
    }

    /**
     * 修改用户
     */
    @PutMapping
    @SaCheckPermission("sys:user:update")
    @Log(description = "修改用户", businessType = BusinessType.UPDATE)
    public ResultData update(@RequestBody SysUser sysUser) {
        return toResult(this.sysUserService.updateAdmin(sysUser));
    }

    /**
     * 删除用户
     */
    @DeleteMapping
    @SaCheckPermission("sys:user:delete")
    @Log(description = "删除用户", businessType = BusinessType.DELETE)
    public ResultData delete(@RequestParam("idList") List<Long> idList) {
        return toResult(this.sysUserService.removeByIds(idList));
    }
}
```

**控制器开发要点：**

- 继承 `BaseController` 获得通用方法
- 使用 `@SaCheckPermission` 进行权限控制
- 使用 `@Log` 注解记录操作日志
- 统一返回 `ResultData` 或 `TableDataInfo`
- 分页查询使用 `startPage()` 和 `getDataTable()`

#### 3. 服务层开发规范

```java
// 服务接口
public interface SysUserService extends IService<SysUser> {
    IPage<SysUser> selectAll(SysUser sysUser, Page<SysUser> page);
    int saveAdmin(SysUser sysUser);
    int updateAdmin(SysUser sysUser);
}

// 服务实现
@Service
public class SysUserServiceImpl extends ServiceImpl<SysUserMapper, SysUser> implements SysUserService {

    @Autowired
    private SysUserRoleService userRoleService;

    @Override
    public IPage<SysUser> selectAll(SysUser sysUser, Page<SysUser> page) {
        return baseMapper.selectAll(sysUser, page);
    }

    @Override
    @Transactional(rollbackFor = Exception.class)
    public int saveAdmin(SysUser sysUser) {
        // 密码加密
        String uid = UUID.randomUUID().toString();
        sysUser.setPassword(SaSecureUtil.md5BySalt(sysUser.getPassword(), uid));
        sysUser.setSalt(uid);

        boolean res = super.save(sysUser);

        // 设置用户角色
        if (res && !sysUser.getRoleIds().isEmpty()) {
            userRoleService.insertUserRole(sysUser);
        }

        return res ? 1 : 0;
    }
}
```

**服务层开发要点：**

- 继承 `ServiceImpl<Mapper, Entity>` 获得基础 CRUD 方法
- 复杂业务逻辑使用 `@Transactional` 事务管理
- 异常统一抛出 `ServiceException`

#### 4. 实体类开发规范

```java
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
@EqualsAndHashCode(callSuper = false)
@TableName("sys_user")
public class SysUser implements Serializable {

    private static final long serialVersionUID = 1L;

    /**
     * 用户ID
     */
    @TableId(value = "id", type = IdType.AUTO)
    private Integer id;

    /**
     * 用户名
     */
    @TableField(value = "user_name")
    @NotNull(message = "用户名不能为空")
    private String userName;

    /**
     * 创建时间
     */
    @TableField(value = "create_time", fill = FieldFill.INSERT)
    private Date createTime;

    /**
     * 更新时间
     */
    @TableField(value = "update_time", fill = FieldFill.INSERT_UPDATE)
    private Date updateTime;

    /**
     * 不存在于数据库的字段
     */
    @TableField(exist = false)
    private List<Integer> roleIds;
}
```

**实体类开发要点：**

- 使用 Lombok 注解简化代码
- 使用 MyBatis Plus 注解配置表映射
- 使用 JSR303 注解进行参数校验
- 敏感字段使用 `@Crypto` 注解加密

#### 5. Mapper 开发规范

```java
@Mapper
public interface SysUserMapper extends BaseMapper<SysUser> {

    /**
     * 分页查询用户列表
     */
    IPage<SysUser> selectAll(@Param("sysUser") SysUser sysUser, @Param("page") Page<SysUser> page);

    /**
     * 批量查询用户
     */
    List<SysUser> selectAllByIds(@Param("ids") List<Long> ids);
}
```

对应的 XML 文件：

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.broad.system.mapper.SysUserMapper">

    <sql id="key">
        su.id, su.user_name, su.nick_name, su.email, su.mobile,
        su.user_status, su.create_time, su.update_time, su.dept_id, su.avatar
    </sql>

    <select id="selectAll" resultType="com.broad.system.entity.SysUser">
        SELECT <include refid="key" />, sd.dept_name as deptName
        FROM sys_user su
        LEFT JOIN sys_dept sd ON su.dept_id = sd.dept_id
        <where>
            <if test="sysUser.userName != null and sysUser.userName != ''">
                AND su.user_name LIKE CONCAT('%', #{sysUser.userName}, '%')
            </if>
            <if test="sysUser.userStatus != null and sysUser.userStatus != ''">
                AND su.user_status = #{sysUser.userStatus}
            </if>
        </where>
    </select>
</mapper>
```

### 前端开发规范

#### 1. 项目结构规范

```
src/
├── api/                 # API 接口
├── assets/             # 静态资源
├── components/         # 公共组件
├── directives/         # 自定义指令
├── hooks/              # 组合式函数
├── router/             # 路由配置
├── store/              # 状态管理
├── styles/             # 样式文件
├── types/              # TypeScript 类型定义
├── utils/              # 工具函数
├── views/              # 页面组件
└── main.ts            # 入口文件
```

#### 2. 自动导入说明

项目已配置自动导入功能，开发时需要注意：

**自动导入的内容：**

- Vue 3 API：`ref`, `reactive`, `computed`, `watch`, `onMounted` 等
- Naive UI 组件：`NCard`, `NForm`, `NInput`, `NSelect` 等常用组件
- 自定义组合式函数：放在 `src/hooks/` 目录下的函数

**仍需手动导入的内容：**

- Naive UI 的组合式函数：`useMessage`, `useDialog`, `useNotification` 等
- 特殊组件：`NButton`, `NPopconfirm` 等在 render 函数中使用的组件
- 图标组件：`@vicons/ionicons5` 等图标库
- 第三方库：`echarts`, `dayjs` 等
- 自定义 API 接口和类型定义

**配置文件位置：**

- `vite.config.ts` 中的 `AutoImport` 和 `Components` 插件配置
- 自动生成的类型文件：`auto-imports.d.ts` 和 `components.d.ts`

  #### 3. API 接口开发规范

```typescript
// api/system/user.ts
import { request } from "@/api/request";

export interface UserQuery {
  userName?: string;
  userStatus?: string;
  pageNum?: number;
  pageSize?: number;
}

export interface User {
  id?: number;
  userName: string;
  nickName?: string;
  email?: string;
  mobile?: string;
  userStatus: string;
  deptId?: number;
  roleIds?: number[];
}

// 查询用户列表
export const getUserList = (params: UserQuery) => {
  return request.get({
    url: "/sysAdmin",
    data: params,
  });
};

// 获取用户详情
export const getUserDetail = (id: number) => {
  return request.get({
    url: `/sysAdmin/${id}`,
  });
};

// 新增用户
export const addUser = (data: User) => {
  return request.post({
    url: "/sysAdmin",
    data,
  });
};

// 修改用户
export const updateUser = (data: User) => {
  return request.put({
    url: "/sysAdmin",
    data,
  });
};

// 删除用户
export const deleteUser = (idList: number[]) => {
  return request.delete({
    url: "/sysAdmin",
    data: { idList },
  });
};
```

#### 4. 页面组件开发规范

```vue
<template>
  <div class="user-management">
    <!-- 查询表单 -->
    <n-card class="search-card">
      <n-form
        ref="queryFormRef"
        :model="queryParams"
        label-placement="left"
        :label-width="80"
      >
        <n-grid :cols="4" :x-gap="16">
          <n-form-item-gi label="用户名" path="userName">
            <n-input
              v-model:value="queryParams.userName"
              placeholder="请输入用户名"
              clearable
            />
          </n-form-item-gi>
          <n-form-item-gi label="状态" path="userStatus">
            <n-select
              v-model:value="queryParams.userStatus"
              placeholder="请选择状态"
              clearable
            >
              <n-option value="0" label="启用" />
              <n-option value="1" label="禁用" />
            </n-select>
          </n-form-item-gi>
          <n-form-item-gi>
            <n-space>
              <n-button type="primary" @click="handleQuery">
                <template #icon>
                  <n-icon><SearchOutline /></n-icon>
                </template>
                查询
              </n-button>
              <n-button @click="resetQuery">
                <template #icon>
                  <n-icon><RefreshOutline /></n-icon>
                </template>
                重置
              </n-button>
            </n-space>
          </n-form-item-gi>
        </n-grid>
      </n-form>
    </n-card>

    <!-- 数据表格 -->
    <n-card class="table-card">
      <template #header>
        <n-space>
          <n-button type="primary" @click="handleAdd">
            <template #icon>
              <n-icon><AddOutline /></n-icon>
            </template>
            新增
          </n-button>
          <n-button
            type="error"
            :disabled="!selectedRowKeys.length"
            @click="handleBatchDelete"
          >
            <template #icon>
              <n-icon><TrashOutline /></n-icon>
            </template>
            删除
          </n-button>
        </n-space>
      </template>

      <n-data-table
        ref="tableRef"
        :columns="columns"
        :data="tableData"
        :loading="loading"
        :pagination="pagination"
        :row-key="(row: User) => row.id"
        @update:checked-row-keys="handleSelectionChange"
      />
    </n-card>

    <!-- 新增/编辑弹窗 -->
    <n-modal v-model:show="showModal" :mask-closable="false">
      <n-card
        style="width: 600px"
        :title="modalTitle"
        :bordered="false"
        size="huge"
      >
        <template #header-extra>
          <n-button quaternary circle @click="showModal = false">
            <template #icon>
              <n-icon><CloseOutline /></n-icon>
            </template>
          </n-button>
        </template>

        <n-form
          ref="formRef"
          :model="formData"
          :rules="rules"
          label-placement="left"
          :label-width="80"
        >
          <n-form-item label="用户名" path="userName">
            <n-input
              v-model:value="formData.userName"
              placeholder="请输入用户名"
            />
          </n-form-item>
          <n-form-item label="昵称" path="nickName">
            <n-input
              v-model:value="formData.nickName"
              placeholder="请输入昵称"
            />
          </n-form-item>
          <n-form-item label="邮箱" path="email">
            <n-input v-model:value="formData.email" placeholder="请输入邮箱" />
          </n-form-item>
          <n-form-item label="手机号" path="mobile">
            <n-input
              v-model:value="formData.mobile"
              placeholder="请输入手机号"
            />
          </n-form-item>
          <n-form-item label="状态" path="userStatus">
            <n-radio-group v-model:value="formData.userStatus">
              <n-radio value="0">启用</n-radio>
              <n-radio value="1">禁用</n-radio>
            </n-radio-group>
          </n-form-item>
        </n-form>

        <template #footer>
          <n-space justify="end">
            <n-button @click="showModal = false">取消</n-button>
            <n-button
              type="primary"
              :loading="submitLoading"
              @click="handleSubmit"
              >确定</n-button
            >
          </n-space>
        </template>
      </n-card>
    </n-modal>
  </div>
</template>

<script setup lang="ts">
// 由于配置了 unplugin-auto-import，以下 Vue API 无需手动导入
// import { ref, reactive, onMounted } from "vue"

// 由于配置了 unplugin-vue-components，Naive UI 组件无需手动导入
// 但部分组件（如 NButton, NPopconfirm）和组合式函数仍需手动导入
import { NButton, NPopconfirm, useMessage } from "naive-ui";
import {
  SearchOutline,
  RefreshOutline,
  AddOutline,
  TrashOutline,
  CloseOutline,
} from "@vicons/ionicons5";
import {
  getUserList,
  getUserDetail,
  addUser,
  updateUser,
  deleteUser,
  type User,
  type UserQuery,
} from "@/api/system/user";

const message = useMessage();

// 响应式数据
const loading = ref(false);
const submitLoading = ref(false);
const showModal = ref(false);
const modalTitle = ref("");
const selectedRowKeys = ref<number[]>([]);
const tableData = ref<User[]>([]);

// 查询参数
const queryParams = reactive<UserQuery>({
  userName: "",
  userStatus: "",
  pageNum: 1,
  pageSize: 10,
});

// 表单数据
const formData = reactive<User>({
  userName: "",
  nickName: "",
  email: "",
  mobile: "",
  userStatus: "0",
});

// 表单验证规则
const rules = {
  userName: [{ required: true, message: "请输入用户名", trigger: "blur" }],
  email: [{ type: "email", message: "请输入正确的邮箱格式", trigger: "blur" }],
};

// 分页配置
const pagination = reactive({
  page: 1,
  pageSize: 10,
  itemCount: 0,
  showSizePicker: true,
  pageSizes: [10, 20, 50, 100],
  onChange: (page: number) => {
    pagination.page = page;
    queryParams.pageNum = page;
    getList();
  },
  onUpdatePageSize: (pageSize: number) => {
    pagination.pageSize = pageSize;
    pagination.page = 1;
    queryParams.pageSize = pageSize;
    queryParams.pageNum = 1;
    getList();
  },
});

// 表格列配置
const columns = [
  { type: "selection" },
  { title: "ID", key: "id", width: 80 },
  { title: "用户名", key: "userName" },
  { title: "昵称", key: "nickName" },
  { title: "邮箱", key: "email" },
  { title: "手机号", key: "mobile" },
  {
    title: "状态",
    key: "userStatus",
    render: (row: User) => {
      return h(
        NButton,
        {
          size: "small",
          type: row.userStatus === "0" ? "success" : "error",
          secondary: true,
        },
        {
          default: () => (row.userStatus === "0" ? "启用" : "禁用"),
        }
      );
    },
  },
  {
    title: "操作",
    key: "actions",
    width: 200,
    render: (row: User) => {
      return h("div", [
        h(
          NButton,
          {
            size: "small",
            type: "primary",
            style: { marginRight: "8px" },
            onClick: () => handleEdit(row),
          },
          { default: () => "编辑" }
        ),
        h(
          NPopconfirm,
          {
            onPositiveClick: () => handleDelete(row.id!),
          },
          {
            default: () => "确定删除吗？",
            trigger: () =>
              h(
                NButton,
                {
                  size: "small",
                  type: "error",
                },
                { default: () => "删除" }
              ),
          }
        ),
      ]);
    },
  },
];

// 方法
const getList = async () => {
  loading.value = true;
  try {
    const { data } = await getUserList(queryParams);
    tableData.value = data.rows;
    pagination.itemCount = data.total;
  } catch (error) {
    message.error("获取数据失败");
  } finally {
    loading.value = false;
  }
};

const handleQuery = () => {
  pagination.page = 1;
  queryParams.pageNum = 1;
  getList();
};

const resetQuery = () => {
  Object.assign(queryParams, {
    userName: "",
    userStatus: "",
    pageNum: 1,
    pageSize: 10,
  });
  pagination.page = 1;
  getList();
};

const handleAdd = () => {
  modalTitle.value = "新增用户";
  Object.assign(formData, {
    userName: "",
    nickName: "",
    email: "",
    mobile: "",
    userStatus: "0",
  });
  showModal.value = true;
};

const handleEdit = async (row: User) => {
  modalTitle.value = "编辑用户";
  try {
    const { data } = await getUserDetail(row.id!);
    Object.assign(formData, data);
    showModal.value = true;
  } catch (error) {
    message.error("获取用户详情失败");
  }
};

const handleSubmit = async () => {
  submitLoading.value = true;
  try {
    if (formData.id) {
      await updateUser(formData);
      message.success("修改成功");
    } else {
      await addUser(formData);
      message.success("新增成功");
    }
    showModal.value = false;
    getList();
  } catch (error) {
    message.error("操作失败");
  } finally {
    submitLoading.value = false;
  }
};

const handleDelete = async (id: number) => {
  try {
    await deleteUser([id]);
    message.success("删除成功");
    getList();
  } catch (error) {
    message.error("删除失败");
  }
};

const handleBatchDelete = async () => {
  try {
    await deleteUser(selectedRowKeys.value);
    message.success("删除成功");
    selectedRowKeys.value = [];
    getList();
  } catch (error) {
    message.error("删除失败");
  }
};

const handleSelectionChange = (keys: number[]) => {
  selectedRowKeys.value = keys;
};

// 生命周期
onMounted(() => {
  getList();
});
</script>

<style scoped lang="scss">
.user-management {
  .search-card {
    margin-bottom: 16px;
  }

  .table-card {
    :deep(.n-card__content) {
      padding: 0;
    }
  }
}
</style>
```

#### 5. 状态管理规范

```typescript
// store/modules/user.ts
import { defineStore } from "pinia";
import { ref } from "vue";

export interface UserInfo {
  id: number;
  userName: string;
  nickName: string;
  avatar: string;
  roles: string[];
  permissions: string[];
}

export const useUserStore = defineStore("user", () => {
  const userInfo = ref<UserInfo | null>(null);
  const token = ref<string>("");

  const setUserInfo = (info: UserInfo) => {
    userInfo.value = info;
  };

  const setToken = (tokenValue: string) => {
    token.value = tokenValue;
    localStorage.setItem("token", tokenValue);
  };

  const clearUserInfo = () => {
    userInfo.value = null;
    token.value = "";
    localStorage.removeItem("token");
  };

  const hasPermission = (permission: string): boolean => {
    return userInfo.value?.permissions.includes(permission) || false;
  };

  return {
    userInfo,
    token,
    setUserInfo,
    setToken,
    clearUserInfo,
    hasPermission,
  };
});

export const useUserStoreHook = () => {
  return useUserStore();
};
```

## 自动导入使用指南

### 配置说明

项目使用了 `unplugin-auto-import` 和 `unplugin-vue-components` 插件实现自动导入功能，大大简化了开发体验。

### 自动导入示例

#### Vue 3 API 自动导入

```vue
<script setup lang="ts">
// ❌ 不需要手动导入
// import { ref, reactive, computed, watch, onMounted } from 'vue'

// ✅ 直接使用，无需导入
const count = ref(0);
const state = reactive({ name: "test" });
const doubleCount = computed(() => count.value * 2);

watch(count, (newVal) => {
  console.log("count changed:", newVal);
});

onMounted(() => {
  console.log("component mounted");
});
</script>
```

#### Naive UI 组件自动导入

```vue
<template>
  <!-- ✅ 直接使用，无需导入 -->
  <n-card title="用户信息">
    <n-form :model="formData">
      <n-form-item label="用户名">
        <n-input v-model:value="formData.username" />
      </n-form-item>
      <n-form-item label="邮箱">
        <n-input v-model:value="formData.email" />
      </n-form-item>
    </n-form>

    <!-- ❌ 这些组件仍需手动导入 -->
    <n-button @click="handleSubmit">提交</n-button>
  </n-card>
</template>

<script setup lang="ts">
// ✅ 需要手动导入的组件（通常是在 render 函数中使用的）
import { NButton } from "naive-ui";

const formData = reactive({
  username: "",
  email: "",
});

const handleSubmit = () => {
  // 处理提交逻辑
};
</script>
```

#### 组合式函数自动导入

```vue
<script setup lang="ts">
// ❌ 不需要手动导入（如果放在 src/hooks/ 目录下）
// import { useUserStore } from '@/hooks/useUserStore'

// ✅ 直接使用自定义 hooks
const userStore = useUserStore();

// ❌ 仍需手动导入 Naive UI 的组合式函数
import { useMessage, useDialog } from "naive-ui";

const message = useMessage();
const dialog = useDialog();
</script>
```

### 自动导入配置文件

查看 `vite.config.ts` 中的配置：

```typescript
import AutoImport from "unplugin-auto-import/vite";
import Components from "unplugin-vue-components/vite";
import { NaiveUiResolver } from "unplugin-vue-components/resolvers";

export default defineConfig({
  plugins: [
    // 自动导入 Vue API
    AutoImport({
      resolvers: [NaiveUiResolver()],
    }),
    // 自动导入组件
    Components({
      resolvers: [NaiveUiResolver()],
    }),
  ],
});
```

### 类型支持

自动导入会生成类型定义文件：

- `auto-imports.d.ts` - Vue API 的类型定义
- `components.d.ts` - 组件的类型定义

这些文件会自动更新，确保 TypeScript 的类型检查正常工作。

### 最佳实践

1. **充分利用自动导入**：对于常用的 Vue API 和 Naive UI 组件，无需手动导入
2. **明确手动导入的场景**：组合式函数、特殊组件、第三方库等仍需手动导入
3. **保持代码整洁**：移除不必要的 import 语句
4. **类型安全**：依赖自动生成的类型文件，确保类型检查正确

## 常用工具类和组件

### 后端工具类

#### 1. 统一响应结果

```java
// 成功响应
return ResultData.success(data);

// 失败响应
return ResultData.error("操作失败");

// 分页响应
return getDataTable(pageResult);
```

#### 2. 分页工具

```java
// 开始分页
Page<SysUser> page = startPage();

// 获取分页结果
return getDataTable(this.sysUserService.selectAll(sysUser, page));
```

#### 3. 权限校验

```java
// 方法级权限校验
@SaCheckPermission("sys:user:list")

// 代码中权限校验
StpUtil.checkPermission("sys:user:add");
```

#### 4. 操作日志

```java
@Log(description = "新增用户", businessType = BusinessType.INSERT)
```

### 前端工具类

#### 1. HTTP 请求

```typescript
// GET 请求
const { data } = await request.get({
  url: "/api/users",
  data: { pageNum: 1, pageSize: 10 },
});

// POST 请求
await request.post({
  url: "/api/users",
  data: userData,
});

// 文件下载
await request.download({
  url: "/api/export",
  data: queryParams,
  filename: "users.xlsx",
});
```

#### 2. 消息提示

```typescript
import { useMessage } from "naive-ui";

const message = useMessage();

message.success("操作成功");
message.error("操作失败");
message.warning("警告信息");
message.info("提示信息");
```

#### 3. 权限指令

```vue
<template>
  <!-- 按钮权限控制 -->
  <n-button v-permission="'sys:user:add'">新增</n-button>

  <!-- 角色权限控制 -->
  <n-button v-role="'admin'">管理员功能</n-button>
</template>
```

#### 4. 表格组件 (TableMain) - 重构版本

项目提供了基于 Naive UI 的高级表格组件，融合了搜索功能，支持拖拽排序、列显示控制、配置持久化等功能。

##### 新版本特性

- ✅ **融合搜索功能**：搜索表单直接集成到表格组件中
- ✅ **动态搜索表单**：支持配置式和自定义两种搜索表单方式
- ✅ **Hook 支持**：提供 `useTableWithSearch` 组合式函数
- ✅ **完全向下兼容**：原有功能保持不变
- ✅ **类型安全**：完整的 TypeScript 类型支持

##### 基本使用（推荐）

```vue
<template>
  <div class="table-custom-page">
    <!-- 使用融合搜索功能的 TableMain 组件 -->
    <TableMain
      :data="tableData"
      :columns="tableColumns"
      :loading="tableLoading"
      :pagination="pagination"
      :search-config="searchConfig"
      :search-form="searchForm"
      v-model:search-model="searchModel"
      @search="handleSearch"
      @reset="handleReset"
      @update:page="handlePageChange"
      @update:page-size="handlePageSizeChange"
    >
      <!-- 表格标题 -->
      <template #header>
        <div class="table-title">
          <h3>用户管理</h3>
          <p>基于重构后的表格组件，融合搜索功能</p>
        </div>
      </template>

      <!-- 表格操作按钮 -->
      <template #header-extra>
        <n-space>
          <AddButton @add="handleAddUser" v-auth="['sys:user:add']" />
          <DeleteButton @delete="onDeleteItem" />
          <n-button type="info" @click="handleExport">导出</n-button>
        </n-space>
      </template>

      <!-- 自定义搜索表单（可选） -->
      <template #search-form>
        <n-form :model="searchModel" label-placement="left">
          <n-grid :cols="24" :x-gap="16" :y-gap="16">
            <n-form-item-gi :span="6" label="姓名" path="name">
              <n-input
                v-model:value="searchModel.name"
                placeholder="请输入姓名"
                clearable
              />
            </n-form-item-gi>
            <n-form-item-gi :span="6" label="年龄" path="age">
              <n-input-number
                v-model:value="searchModel.age"
                placeholder="请输入年龄"
                clearable
                style="width: 100%"
              />
            </n-form-item-gi>
          </n-grid>
        </n-form>
      </template>

      <!-- 表格底部统计信息 -->
      <template #footer>
        <div class="table-footer">
          <n-space justify="space-between">
            <span>共 {{ pagination.total }} 条数据</span>
            <span>当前页显示 {{ tableData.length }} 条</span>
          </n-space>
        </div>
      </template>
    </TableMain>
  </div>
</template>

<script lang="ts" setup>
import { usePagination } from "@/hooks/useTable";
import { useMessage } from "naive-ui";
import { onMounted, ref, reactive } from "vue";
import AddButton from "@/components/table/button/AddButton.vue";
import DeleteButton from "@/components/table/button/DeleteButton.vue";
import TableMain from "@/components/table/main/TableMain.vue";
import type { SearchConfig, SearchFormConfig } from "@/types/table";

// 表格列配置 - 使用 ref 并创建新数组引用
const tableColumns = ref([
  { title: "ID", key: "id", width: 80 },
  { title: "姓名", key: "firstName", width: 120 },
  { title: "年龄", key: "age", width: 100 },
  { title: "邮箱", key: "email", width: 200 },
  { title: "性别", key: "sex", width: 80 },
  { title: "状态", key: "status", width: 80 },
]);

const tableData = ref([]);
const tableLoading = ref(false);
const message = useMessage();
const pagination = usePagination(doRefresh);

// 搜索模型
const searchModel = reactive({
  name: "",
  age: null,
  sex: "",
  status: "",
});

// 搜索配置
const searchConfig: SearchConfig = {
  show: true,
  title: "搜索条件",
  defaultCollapse: true,
  resetOnSearch: true,
  autoSearch: false, // 手动触发搜索
  searchDelay: 300,
};

// 搜索表单配置（配置方式）
const searchForm: SearchFormConfig = {
  items: [
    {
      key: "name",
      label: "姓名",
      type: "input",
      placeholder: "请输入姓名",
      span: 6,
    },
    {
      key: "age",
      label: "年龄",
      type: "number",
      placeholder: "请输入年龄",
      span: 6,
    },
    {
      key: "sex",
      label: "性别",
      type: "select",
      placeholder: "请选择性别",
      options: [
        { label: "男", value: "男" },
        { label: "女", value: "女" },
      ],
      span: 6,
    },
    {
      key: "status",
      label: "状态",
      type: "select",
      placeholder: "请选择状态",
      options: [
        { label: "启用", value: "1" },
        { label: "禁用", value: "0" },
      ],
      span: 6,
    },
  ],
  cols: 24,
  xGap: 16,
  yGap: 16,
  labelWidth: 80,
  labelPlacement: "left",
};

function doRefresh() {
  tableLoading.value = true;
  // 模拟数据获取和搜索过滤逻辑
  setTimeout(() => {
    // ... 数据获取逻辑
    tableLoading.value = false;
  }, 800);
}

function handleAddUser() {
  doRefresh();
  message.success("新增成功");
}

function onDeleteItem(item: any) {
  message.success("删除成功");
  doRefresh();
}

function handleExport() {
  message.info("导出功能开发中...");
}

// 搜索处理
function handleSearch(params: Record<string, any>) {
  console.log("搜索参数:", params);
  Object.assign(searchModel, params);
  pagination.page = 1;
  doRefresh();
  message.success("搜索完成");
}

// 重置处理
function handleReset() {
  Object.assign(searchModel, {
    name: "",
    age: null,
    sex: "",
    status: "",
  });
  pagination.page = 1;
  doRefresh();
  message.success("重置成功");
}

// 分页处理
function handlePageChange(page: number) {
  pagination.page = page;
  doRefresh();
}

function handlePageSizeChange(pageSize: number) {
  pagination.pageSize = pageSize;
  pagination.page = 1;
  doRefresh();
}

onMounted(async () => {
  doRefresh();
});
</script>
```

##### Hook 使用方式（推荐）

使用 `useTableWithSearch` Hook 可以大大简化表格开发：

```vue
<template>
  <div class="table-hook-example">
    <TableMain
      v-bind="tableProps"
      @search="handleSearch"
      @reset="handleReset"
      @update:page="handlePageChange"
      @update:page-size="handlePageSizeChange"
      @update:sorter="handleSorterChange"
      @update:checked-row-keys="handleCheckedRowKeysChange"
    >
      <!-- 表格标题 -->
      <template #header>
        <div class="table-title">
          <h3>用户管理 (Hook 版本)</h3>
          <p>使用 useTableWithSearch Hook 简化开发</p>
        </div>
      </template>

      <!-- 表格操作按钮 -->
      <template #header-extra>
        <n-space>
          <n-button type="primary" @click="handleAdd">新增用户</n-button>
          <n-button
            type="error"
            :disabled="!hasSelected"
            @click="handleBatchDelete"
          >
            批量删除 ({{ selectedCount }})
          </n-button>
          <n-button @click="refresh">刷新</n-button>
        </n-space>
      </template>

      <!-- 表格底部 -->
      <template #footer>
        <div class="table-summary">
          <n-space justify="space-between">
            <span>共 {{ pagination.total }} 条数据</span>
            <span>已选择 {{ selectedCount }} 项</span>
            <n-space>
              <n-button size="small" @click="clearSelection">清空选择</n-button>
              <n-button size="small" @click="selectAll">全选当页</n-button>
            </n-space>
          </n-space>
        </div>
      </template>
    </TableMain>
  </div>
</template>

<script setup lang="ts">
import { h } from "vue";
import { useMessage } from "naive-ui";
import TableMain from "@/components/table/main/TableMain.vue";
import { useTableWithSearch } from "@/composables/useTableWithSearch";
import type { DataTableColumns } from "naive-ui";

const message = useMessage();

// 表格列配置
const columns: DataTableColumns = [
  { type: "selection" },
  { title: "ID", key: "id", width: 80, sorter: true },
  { title: "用户名", key: "username", width: 120 },
  { title: "邮箱", key: "email", width: 200 },
  { title: "状态", key: "status", width: 100 },
  { title: "创建时间", key: "createTime", width: 180, sorter: true },
  {
    title: "操作",
    key: "actions",
    width: 200,
    fixed: "right",
    render: (row: any) => {
      return h("n-space", { size: "small" }, () => [
        h(
          "n-button",
          {
            size: "small",
            type: "primary",
            ghost: true,
            onClick: () => handleEdit(row),
          },
          () => "编辑"
        ),
        h(
          "n-button",
          {
            size: "small",
            type: "error",
            ghost: true,
            onClick: () => handleDelete(row),
          },
          () => "删除"
        ),
      ]);
    },
  },
];

// 模拟API调用
const mockLoadData = async (params: {
  page: number;
  pageSize: number;
  searchParams: Record<string, any>;
  sorter?: any;
}) => {
  // 模拟网络延迟
  await new Promise((resolve) => setTimeout(resolve, 800));

  console.log("加载数据参数:", params);

  // 模拟数据
  const mockData = Array.from({ length: params.pageSize }, (_, index) => ({
    id: (params.page - 1) * params.pageSize + index + 1,
    username: `user${(params.page - 1) * params.pageSize + index + 1}`,
    email: `user${(params.page - 1) * params.pageSize + index + 1}@example.com`,
    status: Math.random() > 0.5 ? 1 : 0,
    createTime: new Date().toISOString().split("T")[0],
  }));

  return {
    data: mockData,
    total: 100, // 模拟总数
  };
};

// 使用 Hook
const {
  loading,
  tableData,
  checkedRowKeys,
  searchModel,
  pagination,
  searchConfig,
  searchForm,
  columns: tableColumns,
  rowKey,
  refresh,
  handleSearch,
  handleReset,
  handlePageChange,
  handlePageSizeChange,
  handleSorterChange,
  handleCheckedRowKeysChange,
  clearSelection,
  selectAll,
  getSelectedRows,
  hasSelected,
  selectedCount,
} = useTableWithSearch({
  columns,
  rowKey: "id",
  searchConfig: {
    show: true,
    title: "搜索条件",
    defaultCollapse: true,
    resetOnSearch: true,
    autoSearch: true,
    searchDelay: 500, // 防抖延迟
  },
  searchForm: {
    items: [
      {
        key: "username",
        label: "用户名",
        type: "input",
        placeholder: "请输入用户名",
        span: 6,
      },
      {
        key: "email",
        label: "邮箱",
        type: "input",
        placeholder: "请输入邮箱",
        span: 6,
      },
      {
        key: "status",
        label: "状态",
        type: "select",
        placeholder: "请选择状态",
        options: [
          { label: "启用", value: 1 },
          { label: "禁用", value: 0 },
        ],
        span: 6,
      },
    ],
    cols: 24,
    xGap: 16,
    yGap: 16,
  },
  initialSearchModel: {
    username: "",
    email: "",
    status: null,
  },
  loadData: mockLoadData,
  immediate: true,
});

// 计算表格属性
const tableProps = {
  loading,
  data: tableData,
  columns: tableColumns,
  pagination,
  searchConfig,
  searchForm,
  searchModel,
  rowKey,
};

// 业务方法
const handleAdd = () => {
  message.info("新增用户");
};

const handleEdit = (row: any) => {
  message.info(`编辑用户: ${row.username}`);
};

const handleDelete = (row: any) => {
  message.warning(`删除用户: ${row.username}`);
};

const handleBatchDelete = () => {
  const selectedRows = getSelectedRows();
  message.warning(`批量删除 ${selectedRows.length} 个用户`);
  console.log("选中的行:", selectedRows);
};
</script>
```

##### 高级使用（需要监听列变化）

如果需要将列配置保存到后端或进行其他处理，可以监听列变化事件：

```vue
<template>
  <TableMain
    :data="tableData"
    :columns="tableColumns"
    :loading="tableLoading"
    :pagination="pagination"
    @update:columns="handleColumnsChange"
  >
    <template #header>
      <n-button type="primary" @click="handleAdd">新增</n-button>
    </template>
  </TableMain>
</template>

<script setup lang="ts">
// 处理列变化事件（可选）
const handleColumnsChange = (newColumns: any[]) => {
  console.log("列配置已更新:", newColumns);

  // 可以在这里保存配置到后端
  // await saveTableConfig(newColumns)

  // 如果需要手动更新本地状态（通常不需要，组件会自动处理）
  // tableColumns.value = [...newColumns]
};
</script>
```

##### 表格组件特性

**自动功能：**

- ✅ **融合搜索功能**：搜索表单直接集成到表格组件中
- ✅ **动态搜索表单**：支持多种表单控件类型的动态配置
- ✅ **拖拽排序**：用户可以在列设置面板中拖拽重新排列列顺序
- ✅ **列显示控制**：用户可以控制列的显示/隐藏
- ✅ **配置持久化**：列配置和表格配置自动保存到 localStorage
- ✅ **全屏模式**：支持表格全屏显示
- ✅ **密度设置**：支持表格密度、边框、斑马纹等配置
- ✅ **自动刷新**：内置刷新按钮
- ✅ **防抖搜索**：支持搜索防抖，避免频繁请求
- ✅ **响应式设计**：移动端自适应布局

**组件 Props：**

| 属性         | 类型            | 默认值 | 说明                |
| ------------ | --------------- | ------ | ------------------- |
| data         | Array           | []     | 表格数据            |
| columns      | Array           | []     | 列配置              |
| loading      | Boolean         | false  | 加载状态            |
| pagination   | Object/Boolean  | false  | 分页配置            |
| rowKey       | String/Function | 'id'   | 行数据的 Key        |
| searchConfig | Object          | {}     | 搜索配置            |
| searchForm   | Object          | -      | 搜索表单配置        |
| searchModel  | Object          | {}     | 搜索模型（v-model） |

**搜索配置 (SearchConfig)：**

| 属性            | 类型    | 默认值 | 说明                 |
| --------------- | ------- | ------ | -------------------- |
| show            | Boolean | true   | 是否显示搜索区域     |
| title           | String  | '搜索' | 搜索区域标题         |
| defaultCollapse | Boolean | true   | 默认是否收起         |
| loading         | Boolean | false  | 搜索按钮加载状态     |
| resetOnSearch   | Boolean | true   | 搜索时是否重置页码   |
| autoSearch      | Boolean | true   | 是否自动搜索         |
| searchDelay     | Number  | -      | 搜索防抖延迟（毫秒） |

**搜索表单配置 (SearchFormConfig)：**

| 属性           | 类型          | 默认值   | 说明                       |
| -------------- | ------------- | -------- | -------------------------- |
| items          | Array         | []       | 表单项配置                 |
| labelWidth     | String/Number | 'auto'   | 标签宽度                   |
| labelPlacement | String        | 'left'   | 标签位置 ('left' \| 'top') |
| size           | String        | 'medium' | 表单大小                   |
| cols           | Number        | 24       | 网格列数                   |
| xGap           | Number        | 16       | 水平间距                   |
| yGap           | Number        | 16       | 垂直间距                   |

**搜索表单项 (SearchFormItem)：**

| 属性         | 类型     | 默认值 | 说明                                                                                        |
| ------------ | -------- | ------ | ------------------------------------------------------------------------------------------- |
| key          | String   | -      | 字段名                                                                                      |
| label        | String   | -      | 标签                                                                                        |
| type         | String   | -      | 控件类型 ('input' \| 'select' \| 'date' \| 'daterange' \| 'number' \| 'switch' \| 'custom') |
| placeholder  | String   | -      | 占位符                                                                                      |
| options      | Array    | -      | 选项（select 类型）                                                                         |
| defaultValue | Any      | -      | 默认值                                                                                      |
| span         | Number   | 6      | 跨度                                                                                        |
| props        | Object   | -      | 组件属性                                                                                    |
| render       | Function | -      | 自定义渲染（custom 类型）                                                                   |

**组件 Events：**

| 事件名                   | 参数     | 说明                         |
| ------------------------ | -------- | ---------------------------- |
| search                   | params   | 搜索事件                     |
| reset                    | -        | 重置事件                     |
| update:search-model      | model    | 搜索模型变化                 |
| update:search-collapse   | value    | 搜索区域展开/收起            |
| update:columns           | columns  | 列配置变化时触发（可选监听） |
| update:page              | page     | 页码变化时触发               |
| update:page-size         | pageSize | 页大小变化时触发             |
| update:sorter            | sorter   | 排序变化时触发               |
| update:checked-row-keys  | keys     | 选中行变化时触发             |
| update:expanded-row-keys | keys     | 展开行变化时触发             |

**组件 Slots：**

| 插槽名       | 说明                 |
| ------------ | -------------------- |
| header       | 表格头部标题区域     |
| header-extra | 表格头部操作按钮区域 |
| search-title | 搜索区域标题         |
| search-form  | 自定义搜索表单       |
| footer       | 表格底部内容         |

**组件暴露的方法：**

| 方法名             | 说明             |
| ------------------ | ---------------- |
| search()           | 执行搜索         |
| resetSearch()      | 重置搜索         |
| getSearchData()    | 获取搜索数据     |
| validateSearch()   | 验证搜索表单     |
| clearChecked()     | 清空选中         |
| clearFilters()     | 清空过滤器       |
| clearSorter()      | 清空排序         |
| toggleFullscreen() | 切换全屏         |
| getTableRef()      | 获取表格实例     |
| getSearchFormRef() | 获取搜索表单实例 |

##### 最佳实践

1. **使用 Hook 简化开发**：

   ```typescript
   // ✅ 推荐：使用 useTableWithSearch Hook
   const {
     loading,
     tableData,
     pagination,
     searchConfig,
     searchForm,
     searchModel,
     handleSearch,
     handleReset,
     // ... 其他方法
   } = useTableWithSearch({
     columns,
     searchForm,
     loadData: apiFunction,
   });

   // ❌ 避免：手动管理所有状态
   const loading = ref(false);
   const tableData = ref([]);
   const searchModel = reactive({});
   // ... 大量重复代码
   ```

2. **列配置定义**：

   ```typescript
   // ✅ 推荐：使用 ref 并创建新数组引用
   const tableColumns = ref([...originalColumns]);

   // ❌ 避免：直接使用 reactive
   const tableColumns = reactive(originalColumns);
   ```

3. **搜索表单配置**：

   ```typescript
   // ✅ 推荐：使用配置方式
   const searchForm: SearchFormConfig = {
     items: [
       {
         key: 'username',
         label: '用户名',
         type: 'input',
         placeholder: '请输入用户名',
         span: 6
       },
       {
         key: 'status',
         label: '状态',
         type: 'select',
         options: statusOptions,
         span: 6
       }
     ]
   }

   // ✅ 也可以：使用自定义模板
   <template #search-form>
     <n-form :model="searchModel">
       <!-- 自定义表单内容 -->
     </n-form>
   </template>
   ```

4. **简化使用**：

   ```vue
   <!-- ✅ 推荐：新版本融合搜索功能 -->
   <TableMain
     :search-config="searchConfig"
     :search-form="searchForm"
     v-model:search-model="searchModel"
     @search="handleSearch"
     @reset="handleReset"
   />

   <!-- ❌ 旧方式：分离的搜索和表格组件 -->
   <TableSearch @search="handleSearch" @reset="handleReset">
     <!-- 搜索表单 -->
   </TableSearch>
   <TableMain :data="tableData" :columns="tableColumns" />
   ```

5. **性能优化**：

   ```typescript
   // ✅ 推荐：使用防抖搜索
   const searchConfig: SearchConfig = {
     autoSearch: true,
     searchDelay: 500, // 500ms 防抖
   };

   // ✅ 推荐：合理设置分页大小
   const pagination = {
     pageSize: 20, // 根据实际情况调整
     pageSizes: [10, 20, 50, 100],
   };
   ```

6. **权限控制**：

   ```vue
   <template #header-extra>
     <n-space>
       <AddButton @add="handleAdd" v-auth="['sys:user:add']" />
       <EditButton @edit="handleEdit" v-auth="['sys:user:edit']" />
       <DeleteButton @delete="handleDelete" v-auth="['sys:user:delete']" />
     </n-space>
   </template>
   ```

7. **错误处理**：

   ```typescript
   // ✅ 推荐：在 loadData 函数中处理错误
   const loadData = async (params) => {
     try {
       const response = await api.getUsers(params);
       return {
         data: response.data,
         total: response.total,
       };
     } catch (error) {
       console.error("加载数据失败:", error);
       message.error("加载数据失败");
       return {
         data: [],
         total: 0,
       };
     }
   };
   ```

##### 故障排除

**拖拽排序不生效：**

- 确保列配置中有 `key` 和 `title` 属性
- 检查是否有重复的 `key` 值
- 确保使用 `ref([...columns])` 而不是 `reactive(columns)`

**列顺序不更新：**

- 使用展开运算符创建新数组引用：`ref([...columns])`
- 避免直接修改原数组

**配置不保存：**

- 检查浏览器是否支持 localStorage
- 确保没有禁用本地存储功能

## 部署指南

### Docker 部署

```bash
# 构建镜像
docker build -t broad-admin .

# 运行容器
docker-compose up -d
```

### 传统部署

#### 后端部署

```bash
# 打包
mvn clean package -Dmaven.test.skip=true

# 运行
java -jar broad-admin/target/broad-admin-2.2.0.jar
```

#### 前端部署

```bash
cd broad-admin-ui
pnpm build

# 将 dist 目录部署到 Nginx
```

### Nginx 配置

```nginx
server {
    listen 80;
    server_name your-domain.com;

    # 前端静态文件
    location / {
        root /path/to/dist;
        try_files $uri $uri/ /index.html;
    }

    # 后端 API 代理
    location /api/ {
        proxy_pass http://localhost:9010/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

## 常见问题

### 1. 跨域问题

前端开发环境已配置代理，生产环境需要在 Nginx 中配置 CORS 或使用代理。

### 2. 权限问题

确保用户拥有对应的权限标识，权限标识格式：`模块:功能:操作`，如 `sys:user:list`。

### 3. 数据库连接问题

检查数据库配置、网络连接和防火墙设置。

### 4. 缓存问题

Redis 连接失败会影响登录和权限功能，确保 Redis 服务正常运行。

### 5. 表格组件问题

#### 拖拽排序不生效

- **问题**：用户反映列弹出层拖动重新排列没有效果，一拖动就会还原到原来的位置
- **原因**：使用了 `reactive` 而不是 `ref`，或者没有正确创建新数组引用
- **解决方案**：

  ```typescript
  // ✅ 正确写法
  const tableColumns = ref([...originalColumns]);

  // ❌ 错误写法
  const tableColumns = reactive(originalColumns);
  ```

#### 表格列没有实际改变

- **问题**：拖拽可以进行，但实际表格列没有改变
- **原因**：缺少 `@update:columns` 事件监听器或处理不当
- **解决方案**：

  ```vue
  <!-- 新版本（推荐）：组件自动处理 -->
  <TableMain :columns="tableColumns" :data="tableData" />

  <!-- 旧版本：需要手动监听 -->
  <TableMain
    :columns="tableColumns"
    :data="tableData"
    @update:columns="handleColumnsChange"
  />
  ```

#### 列配置不持久化

- **问题**：页面刷新后列配置丢失
- **原因**：浏览器禁用了 localStorage 或配置保存失败
- **解决方案**：
  - 检查浏览器设置，确保允许本地存储
  - 检查控制台是否有相关错误信息
  - 手动清除 localStorage 中的表格配置缓存

#### TypeScript 类型错误

- **问题**：表格组件使用时出现类型错误
- **原因**：类型定义不完整或导入错误
- **解决方案**：

  ```typescript
  // 确保正确导入类型
  import type { DataTableColumns } from "naive-ui";
  import type { TableMainProps } from "@/types/table";

  // 正确定义列类型
  const tableColumns = ref<DataTableColumns>([
    { title: "ID", key: "id", width: 80 },
    // ...
  ]);
  ```

## 扩展开发

### 1. 新增模块

1. 在对应模块下创建 entity、mapper、service、controller
2. 配置数据库表和权限数据
3. 前端创建对应的页面和 API 接口

### 2. 自定义组件

前端组件放在 `src/components` 目录下，按功能分类组织。

#### 表格组件扩展

项目的表格组件采用模块化设计，可以根据需要进行扩展：

**组件结构：**

```
src/components/table/
├── main/
│   ├── TableMain.vue          # 主表格组件（融合搜索功能）
│   ├── SortableTable.vue      # 列排序和显示控制
│   └── TableConfig.vue        # 表格配置面板
├── search/
│   └── SearchForm.vue         # 动态搜索表单组件
├── button/
│   ├── AddButton.vue          # 新增按钮
│   ├── EditButton.vue         # 编辑按钮
│   ├── DeleteButton.vue       # 删除按钮
│   ├── SearchButton.vue       # 搜索按钮
│   ├── ResetButton.vue        # 重置按钮
│   ├── ExportButton.vue       # 导出按钮
│   └── index.ts              # 按钮组件统一导出
├── hooks/
│   └── useTable.ts           # 表格相关 hooks
└── types/
    └── table.ts              # 表格类型定义
```

**扩展示例：**

1. **自定义操作按钮**：

   ```vue
   <!-- CustomButton.vue -->
   <template>
     <n-button
       type="warning"
       size="small"
       @click="handleCustomAction"
       v-auth="auth"
     >
       <template #icon>
         <n-icon><CustomIcon /></n-icon>
       </template>
       {{ label }}
     </n-button>
   </template>

   <script setup lang="ts">
   interface Props {
     auth?: string[];
     label?: string;
   }

   const props = withDefaults(defineProps<Props>(), {
     label: "自定义操作",
   });

   const emit = defineEmits<{
     action: [];
   }>();

   const handleCustomAction = () => {
     emit("action");
   };
   </script>
   ```

2. **扩展表格配置**：

   ```typescript
   // 在 types/table.ts 中扩展配置接口
   export interface ExtendedTableConfig extends TableConfig {
     showIndex?: boolean; // 显示序号列
     showSelection?: boolean; // 显示选择列
     autoHeight?: boolean; // 自动高度
     virtualScroll?: boolean; // 虚拟滚动
   }
   ```

3. **自定义 Hook**：

   ```typescript
   // hooks/useAdvancedTable.ts
   export function useAdvancedTable(options: {
     api: Function;
     defaultParams?: Record<string, any>;
     autoLoad?: boolean;
   }) {
     const loading = ref(false);
     const data = ref([]);
     const pagination = ref({
       page: 1,
       pageSize: 10,
       total: 0,
     });

     const loadData = async (params = {}) => {
       loading.value = true;
       try {
         const result = await options.api({
           ...options.defaultParams,
           ...params,
           pageNum: pagination.value.page,
           pageSize: pagination.value.pageSize,
         });
         data.value = result.data.rows;
         pagination.value.total = result.data.total;
       } finally {
         loading.value = false;
       }
     };

     if (options.autoLoad) {
       onMounted(() => loadData());
     }

     return {
       loading,
       data,
       pagination,
       loadData,
       refresh: () => loadData(),
     };
   }
   ```

### 3. 自定义工具类

后端工具类放在 `broad-common/src/main/java/com/broad/common/utils` 目录下。

### 4. 自定义配置

配置类放在 `broad-framework/src/main/java/com/broad/framework/config` 目录下。

### 5. 统一按钮组件

项目提供了一套风格统一的按钮组件，支持常见的表格操作：

#### 按钮组件列表

| 组件名       | 说明     | 默认类型 | 事件                               |
| ------------ | -------- | -------- | ---------------------------------- |
| AddButton    | 新增按钮 | primary  | @add, @click                       |
| EditButton   | 编辑按钮 | warning  | @edit, @click                      |
| DeleteButton | 删除按钮 | error    | @delete, @confirm, @cancel, @click |
| SearchButton | 搜索按钮 | primary  | @search, @click                    |
| ResetButton  | 重置按钮 | tertiary | @reset, @click                     |
| ExportButton | 导出按钮 | default  | @export, @success, @error, @click  |

#### 基本使用

```vue
<template>
  <n-space>
    <!-- 新增按钮 -->
    <AddButton @add="handleAdd" title="添加用户" />

    <!-- 编辑按钮 -->
    <EditButton @edit="handleEdit" :disabled="!selectedRow" />

    <!-- 删除按钮 -->
    <DeleteButton
      @delete="handleDelete"
      confirm-content="确定要删除选中的数据吗？"
      :disabled="!hasSelected"
    />

    <!-- 搜索按钮 -->
    <SearchButton @search="handleSearch" :loading="searchLoading" />

    <!-- 重置按钮 -->
    <ResetButton @reset="handleReset" />

    <!-- 导出按钮 -->
    <ExportButton @export="handleExport" filename="用户列表" file-type="xlsx" />
  </n-space>
</template>

<script setup lang="ts">
// 统一导入方式
import {
  AddButton,
  EditButton,
  DeleteButton,
  SearchButton,
  ResetButton,
  ExportButton,
} from "@/components/table/button";

// 或者单独导入
// import AddButton from '@/components/table/button/AddButton.vue'

const handleAdd = () => {
  console.log("新增操作");
};

const handleEdit = () => {
  console.log("编辑操作");
};

const handleDelete = () => {
  console.log("删除操作");
};

const handleSearch = () => {
  console.log("搜索操作");
};

const handleReset = () => {
  console.log("重置操作");
};

const handleExport = () => {
  console.log("导出操作");
};
</script>
```

#### 按钮属性

所有按钮组件都支持以下通用属性：

| 属性       | 类型    | 默认值  | 说明         |
| ---------- | ------- | ------- | ------------ |
| title      | String  | -       | 按钮文本     |
| disabled   | Boolean | false   | 是否禁用     |
| loading    | Boolean | false   | 是否加载中   |
| type       | String  | -       | 按钮类型     |
| size       | String  | 'small' | 按钮大小     |
| ghost      | Boolean | true    | 是否幽灵按钮 |
| round      | Boolean | false   | 是否圆角     |
| circle     | Boolean | false   | 是否圆形     |
| quaternary | Boolean | false   | 是否四级按钮 |
| dashed     | Boolean | false   | 是否虚线边框 |

#### DeleteButton 特有属性

| 属性           | 类型    | 默认值           | 说明         |
| -------------- | ------- | ---------------- | ------------ |
| confirmContent | String  | '确定要删除吗？' | 确认提示内容 |
| confirmText    | String  | '确定'           | 确认按钮文本 |
| cancelText     | String  | '取消'           | 取消按钮文本 |
| needConfirm    | Boolean | true             | 是否需要确认 |

#### ExportButton 特有属性

| 属性     | 类型   | 默认值   | 说明       |
| -------- | ------ | -------- | ---------- |
| filename | String | 'export' | 导出文件名 |
| fileType | String | 'xlsx'   | 文件类型   |

#### 权限控制

按钮组件支持权限指令：

```vue
<template>
  <!-- 使用权限指令 -->
  <AddButton @add="handleAdd" v-auth="['sys:user:add']" />
  <EditButton @edit="handleEdit" v-auth="['sys:user:edit']" />
  <DeleteButton @delete="handleDelete" v-auth="['sys:user:delete']" />
</template>
```

#### 自定义样式

```vue
<template>
  <!-- 自定义按钮样式 -->
  <AddButton
    @add="handleAdd"
    type="success"
    size="medium"
    :ghost="false"
    round
  />
</template>
```

---

本文档涵盖了 Broad Admin 项目的核心开发规范和最佳实践，开发者可以根据此文档快速上手项目开发。如有疑问，请参考项目源码或联系项目维护者。
